{"version":3,"file":"index.js","sources":["../src/core/path.ts","../src/core/types.ts","../src/core/FilterChain.ts","../src/ajax/AjaxResponseImpl.ts","../src/ajax/newAjaxRequest.ts","../src/ajax/SuperAgentAjaxAPI.ts","../node_modules/mime-db/index.js","../src/core/utils.ts","../src/core/internal/transformFilesParameterFilter.ts","../src/core/Ajax.ts","../src/core/internal/validateRequiredParameterFilters.ts","../src/core/internal/defaultValueFilter.ts","../src/core/internal/optionsValidatorFilters.ts","../src/core/Template.ts","../src/core/internal/pathVariableFilter.ts","../src/core/internal/queriesFilter.ts","../src/core/internal/jsonParameterFilter.ts","../src/core/Endpoint.ts","../src/index.ts"],"sourcesContent":["const replacePrefRegExp = /^[/\\\\]+(.*)/;\nconst replaceSufRegExp = /\\/$/;\nconst replaceSepsRegExp = /[/\\\\]+/g;\n/**\n *\n * join paths with path separator '/'\n * @export\n * @param {...string[]} paths\n * @returns {string}\n */\nexport function join(...paths: string[]): string {\n    console.info(paths);\n    return paths\n        .filter(path => !!path)\n        .map(path => {\n            if (path.match(/^[a-z]+:\\/{2,}.*/i)) {\n                return path.replace(replaceSufRegExp, '');\n            }\n            return path\n                .replace(replacePrefRegExp, '$1')\n                .replace(replaceSepsRegExp, '/')\n                .replace(replaceSufRegExp, '');\n        })\n        .join('/');\n}\n","import { Filter } from './FilterChain';\n\nexport type Primitive = string | boolean | number;\nexport type IDirection = 'download' | 'upload';\nexport type TypedArray =\n    | Uint8Array\n    | Uint16Array\n    | Uint32Array\n    | Uint8ClampedArray\n    | Int8Array\n    | Int16Array\n    | Int32Array\n    | Float32Array\n    | Float64Array;\nexport type StreamData = File | Blob | ArrayBuffer | TypedArray;\nexport type ResponseType = 'blob' | 'arraybuffer';\n\nexport interface IQueriesData {\n    [key: string]: Primitive;\n}\nexport interface IHeadersData {\n    [key: string]: string;\n}\nexport interface IFormData {\n    [key: string]: string;\n}\nexport interface IPathVariables {\n    [key: string]: string;\n}\n\nexport enum HttpMethod {\n    GET,\n    POST,\n    PUT,\n    DELETE,\n    PATCH,\n    HEAD,\n}\n\nexport enum FilterOpportunity {\n    REQUEST,\n    RESPONSE_SUCCESS,\n    RESPONSE_ERROR,\n}\nexport interface IFiltersConfig {\n    request?: Filter | Filter[];\n    success?: Filter | Filter[];\n    failure?: Filter | Filter[];\n}\n\nexport interface Progress {\n    direction: IDirection;\n    loaded: number;\n    percent?: number;\n    total?: number;\n}\n\nexport type ProgressHandler = (prog: Progress) => void;\nexport type AbortHandler = () => void;\nexport type ErrorHandler = (err: any) => void;\n\nexport interface IListeners {\n    progresss: ProgressHandler;\n    abort: AbortHandler;\n    error: ErrorHandler;\n}\nexport type RequestParamField =\n    | 'pathVariables'\n    | 'queries'\n    | 'headers'\n    | 'formdata';\n\nexport interface IParamConfig {\n    name: string;\n    defaultValue?: Primitive;\n    required?: boolean;\n    validator?: Validator;\n}\n\nexport interface IQueryConfig extends IParamConfig {\n    defaultValue?: Primitive;\n}\n\nexport interface IHeaderConfig extends IParamConfig {\n    defaultValue: string;\n}\n\nexport interface IPathVariable extends IParamConfig {\n    defaultValue?: string;\n}\n\nexport interface IFormdataConfig extends IParamConfig {\n    defaultValue?: Primitive;\n}\n\nexport interface IAPIConfig {\n    [key: string]: any;\n    url?: string;\n    path?: string;\n    method: HttpMethod;\n    pathVariables?: IPathVariable[];\n    queries?: IQueryConfig[];\n    headers?: IHeaderConfig[];\n    formdata?: IFormdataConfig[];\n    filters?: IFiltersConfig;\n    listeners?: IListeners;\n    credential?: ICredential;\n}\nexport interface ICredential {\n    username: string;\n    password: string;\n}\nexport interface IAjaxRequestOptions {\n    [key: string]: any;\n    method?: HttpMethod;\n    queries?: IQueriesData;\n    headers?: IHeadersData;\n    pathVariables?: IPathVariables;\n    filters?: IFiltersConfig;\n    credential?: ICredential;\n    formdata?: FormData | IFormData;\n    files?: StreamData | string | string[] | StreamData[] | object | object[];\n    json?: string;\n    contentType?: string;\n    responseType?: ResponseType;\n}\nexport interface InternalAjaxRequestOptions extends IAjaxRequestOptions {\n    apiConfig: IAPIConfig;\n    url: string;\n}\n\nexport type Validator = (value: any, params: IAjaxRequestOptions) => boolean;\n\nexport interface ResponseError extends Error {\n    status: number;\n    text: string;\n    method: string;\n    path: string;\n}\n\nexport type CallbackHandler = (err: any, res: AjaxResponse) => void;\n\nexport interface IEndpointConfigure {\n    basePath: string;\n    filters: IFiltersConfig;\n    apis: { [name: string]: IAPIConfig };\n}\nexport interface AjaxResponse {\n    accepted: boolean;\n    badRequest: boolean;\n    body: any;\n    charset: string;\n    clientError: boolean;\n    error: ResponseError;\n    files: any;\n    forbidden: boolean;\n    headers: IHeadersData;\n    info: boolean;\n    noContent: boolean;\n    notAcceptable: boolean;\n    notFound: boolean;\n    ok: boolean;\n    redirect: boolean;\n    serverError: boolean;\n    status: number;\n    statusType: number;\n    text: string;\n    type: string;\n    unauthorized: boolean;\n    getHeader(name: string): string;\n}\n\nexport interface AjaxRequest extends Promise<any> {\n    abort(): void;\n    progress(handler: ProgressHandler): void;\n    on(name: 'abort', handler: AbortHandler): void;\n    on(name: 'error', handler: ErrorHandler): void;\n    on(name: string, handler: (event: any) => void): void;\n    retry(count: number, callback: CallbackHandler): void;\n    then(\n        fullfilled?: (value: any) => any,\n        onrejected?: ((reason: any) => any)\n    ): AjaxRequest;\n    catch(onrejected?: ((reason: any) => any)): AjaxRequest;\n}\n","export type Filter = (value: any, chain: FilterChain) => any;\n\nconst TERMINAL_RESULT = new Promise(() => undefined);\n\nexport default class FilterChain {\n    public static isTerminal(value: any) {\n        return TERMINAL_RESULT === value;\n    }\n    /**\n     * @constructs FilterChain\n     * @hideconstructor\n     * @param {Filter[]} filters\n     * @param {number} index\n     */\n    constructor(private filters: Filter[], private index: number) {\n        this.filters = filters.slice(0);\n        this.index = index;\n    }\n    public next(value: any): any {\n        if (this.index >= this.filters.length) {\n            return this.finish(value);\n        }\n\n        const filter = this.filters[this.index];\n        const nextchain = this.nextchain();\n        return filter(value, nextchain);\n    }\n    public retry(value: any) {\n        return this.chainAt(0).start(value);\n    }\n    public start(value: any) {\n        return this.next(value);\n    }\n    public error(reason: Error) {\n        return Promise.reject(reason);\n    }\n    public finish(result: any) {\n        return result;\n    }\n    public terminal() {\n        return TERMINAL_RESULT;\n    }\n    private chainAt(index: number): FilterChain {\n        return new FilterChain(this.filters, index);\n    }\n    private nextchain(): FilterChain {\n        return this.chainAt(this.index + 1);\n    }\n}\n","import { Response } from 'superagent';\nimport { ResponseError, AjaxResponse, IHeadersData } from '../core/types';\n\nexport default class AjaxResponseImpl implements AjaxResponse {\n    public get accepted(): boolean {\n        return this.resp.accepted;\n    }\n    public get badRequest(): boolean {\n        return this.resp.badRequest;\n    }\n    public get body(): any {\n        return this.resp.body;\n    }\n    public get charset(): string {\n        return this.resp.charset;\n    }\n    public get clientError(): boolean {\n        return this.resp.clientError;\n    }\n    public get error(): ResponseError {\n        return this.resp.error;\n    }\n    public get files(): any {\n        return this.resp.files;\n    }\n    public get forbidden(): boolean {\n        return this.resp.forbidden;\n    }\n    public get headers(): IHeadersData {\n        return this.resp.header;\n    }\n    public get info(): boolean {\n        return this.resp.info;\n    }\n    public get noContent(): boolean {\n        return this.resp.noContent;\n    }\n    public get notAcceptable(): boolean {\n        return this.resp.notAcceptable;\n    }\n    public get notFound(): boolean {\n        return this.resp.notFound;\n    }\n    public get ok(): boolean {\n        return this.resp.ok;\n    }\n    public get unauthorized(): boolean {\n        return this.resp.unauthorized;\n    }\n    public get redirect(): boolean {\n        return this.resp.redirect;\n    }\n    public get serverError(): boolean {\n        return this.resp.serverError;\n    }\n    public get status(): number {\n        return this.resp.status;\n    }\n    public get statusType(): number {\n        return this.resp.statusType;\n    }\n    public get text(): string {\n        return this.resp.text;\n    }\n    public get type(): string {\n        return this.resp.type;\n    }\n    constructor(private resp: Response) {}\n    public getHeader(name: string): string {\n        return this.resp.get(name);\n    }\n}\n","// tslint:disable max-classes-per-file\n\nimport {\n    AjaxRequest,\n    ProgressHandler,\n    AbortHandler,\n    ErrorHandler,\n    CallbackHandler,\n} from '../core/types';\nimport { Request, Response } from 'superagent';\nimport AjaxResponseImpl from './AjaxResponseImpl';\n\nexport type EventHandler = (event: any) => void | AbortHandler | ErrorHandler;\n\nfunction extendPromise<T>(promise: Promise<T>, methods: {}): AjaxRequest {\n    const promiseThen = promise.then;\n    const promiseCatch = promise.catch;\n\n    return Object.assign(promise, methods, {\n        then(\n            fullfilled: (value: any) => any,\n            onrejected: ((reason: any) => any)\n        ): AjaxRequest {\n            const newPromise = promiseThen.call(\n                promise,\n                fullfilled,\n                onrejected\n            );\n            return extendPromise(newPromise, methods);\n        },\n        catch(onrejected?: ((reason: any) => any)): AjaxRequest {\n            const newPromise = promiseCatch.call(promise, onrejected);\n            return extendPromise(newPromise, methods);\n        },\n    }) as AjaxRequest;\n}\nexport default function newAjaxRequest(req: Request): AjaxRequest {\n    const promise = new Promise((resolve, reject) => {\n        req.then(\n            (resp: Response) => resolve(new AjaxResponseImpl(resp)),\n            reject\n        );\n    });\n    const methods = {\n        abort(): void {\n            req.abort();\n        },\n        progress(handler: ProgressHandler): void {\n            req.on('progress', handler);\n        },\n        on(name: string, handler: EventHandler): void {\n            req.on(name, handler);\n        },\n        retry(count: number, callback: CallbackHandler): void {\n            req.retry(count, (err: any, res: Response) => {\n                callback(err, new AjaxResponseImpl(res));\n            });\n        },\n    };\n    return extendPromise(promise, methods);\n}\n","import IAjaxAPI, { IRequestOptions } from '../core/AjaxAPI';\nimport * as request from 'superagent';\nimport { HttpMethod, AjaxRequest } from '../core/types';\nimport newAjaxRequest from './newAjaxRequest';\n\nexport default class SuperAgentAjaxAPI implements IAjaxAPI {\n    public request(options: IRequestOptions): AjaxRequest {\n        const req = this.createRequest(options);\n        req\n            .on('progress', e => {\n                if (options.onprogress) {\n                    options.onprogress({\n                        ...e,\n                    });\n                }\n            })\n            .on('abort', e => {\n                if (options.onabort) {\n                    options.onabort();\n                }\n            })\n            .send(options.payload);\n        return newAjaxRequest(req);\n    }\n    private createRequest(options: IRequestOptions): request.Request {\n        let req;\n        switch (options.method) {\n            case HttpMethod.GET:\n                req = request.get(options.url);\n                break;\n            case HttpMethod.DELETE:\n                req = request.del(options.url);\n                break;\n            case HttpMethod.PATCH:\n                req = request.patch(options.url);\n                break;\n            case HttpMethod.HEAD:\n                req = request.head(options.url);\n                break;\n            case HttpMethod.POST:\n                req = request.post(options.url);\n                break;\n            case HttpMethod.PUT:\n                req = request.put(options.url);\n                break;\n            default:\n                throw new Error(`Unexpected request method: ${options.method}`);\n        }\n        if (options.credential) {\n            req.auth(options.credential.username, options.credential.password);\n        }\n        if (options.queries) {\n            req.query(options.queries);\n        }\n        if (options.headers) {\n            req.set(options.headers);\n        }\n        if (options.contentType) {\n            req.set('Content-Type', options.contentType);\n        }\n        if (options.responseType) {\n            req.responseType(options.responseType);\n        }\n        return req;\n    }\n}\n","/*!\n * mime-db\n * Copyright(c) 2014 Jonathan Ong\n * MIT Licensed\n */\n\n/**\n * Module exports.\n */\n\nmodule.exports = require('./db.json')\n","import { TypedArray } from './types';\n// import * as mimetype from 'mime-types';\nimport * as filetype from 'file-type';\n\nimport * as db from 'mime-db';\n\nconst mimeData = db as db.MimeTypeData;\n\nconst extToMime: {\n    [ext: string]: string;\n} = {};\n\nObject.keys(mimeData).reduce((prev, type: string) => {\n    const info: db.DataStructure = mimeData[type];\n    if (info.extensions) {\n        info.extensions.reduce((_: any, ext: string) => {\n            _[ext] = type;\n            return _;\n        }, prev);\n    }\n    return prev;\n}, extToMime);\n\nfunction argumentsToString() {\n    return arguments.toString();\n}\nconst ARGUMENT_TO_STRING = argumentsToString();\n\nexport const isArgument = (arg: any) =>\n    arg && arg.toString() === ARGUMENT_TO_STRING;\n\nexport function toArray<T>(...args: any[]): T[] {\n    if (this.isArgument(args[0])) {\n        return toArray.apply(null, args[0]);\n    } else {\n        return args;\n    }\n}\nexport function isTypedArray(value: any): boolean {\n    return (\n        Object.getPrototypeOf(Object.getPrototypeOf(value)).constructor.name ===\n        'TypedArray'\n    );\n}\n\nexport function mime(\n    input: string | ArrayBuffer | TypedArray\n): string | undefined {\n    if (typeof input === 'string') {\n        const ext = input.replace(/^.*\\.([a-z]+)$/i, '$1');\n        return extToMime[ext];\n    } else {\n        if (input instanceof ArrayBuffer) {\n            input = new Uint8Array(input);\n        } else {\n            input = new Uint8Array(input.buffer);\n        }\n        return filetype.call(null, input).mime;\n    }\n}\n","import { IAjaxRequestOptions } from '../types';\nimport FilterChain from '../FilterChain';\nimport { isTypedArray, mime } from '../utils';\n\nexport default function transformFilesParameterFilter(\n    options: IAjaxRequestOptions,\n    chain: FilterChain\n) {\n    if (!options.files || typeof FormData === 'undefined') {\n        return chain.next(options);\n    }\n    const formdata = new FormData();\n    let files = options.files;\n\n    if (!(files instanceof Array)) {\n        files = [files];\n    }\n\n    (files as any[]).forEach(file => {\n        if (file instanceof File) {\n            formdata.append((file as any).filename, file);\n        } else {\n            let data = file.data || file;\n            const filename = file.filename || file.name;\n            const partname = file.name || data.name || filename;\n\n            if (typeof data === 'string') {\n                const type =\n                    mime(filename) ||\n                    file.type ||\n                    options.contentType ||\n                    'text/plain';\n                data = new Blob([data], {\n                    type,\n                });\n            } else if (isTypedArray(data)) {\n                const type =\n                    mime(data) ||\n                    file.type ||\n                    options.contentType ||\n                    'application/octet-stream';\n                data = new Blob(data, {\n                    type,\n                });\n            } else if (!(data instanceof Blob)) {\n                const type =\n                    mime(data) ||\n                    file.type ||\n                    options.contentType ||\n                    'application/json';\n                data = new Blob([JSON.stringify(data)], {\n                    type,\n                });\n            }\n            formdata.append(partname, data, filename);\n        }\n    });\n    options.formdata = formdata;\n    options.contentType = undefined;\n    return chain.next(options);\n}\n","import {\n    IFiltersConfig,\n    HttpMethod,\n    IAPIConfig,\n    IAjaxRequestOptions,\n    AjaxRequest,\n    InternalAjaxRequestOptions,\n} from './types';\nimport Endpoint from './Endpoint';\nimport FilterChain, { Filter } from './FilterChain';\nimport { IRequestOptions } from './AjaxAPI';\nimport SuperAgentAjaxAPI from '../ajax/SuperAgentAjaxAPI';\nimport transformFilesParameterFilter from './internal/transformFilesParameterFilter';\n\nexport type FiltersType = undefined | Filter | Filter[];\n\nexport interface AjaxOptions {\n    url: string;\n    filters?: IFiltersConfig;\n    endpoint: Endpoint;\n    method: HttpMethod;\n    config: IAPIConfig;\n}\n\nconst api = new SuperAgentAjaxAPI();\n\nexport default class Ajax {\n    private url: string;\n    private requestFilters: Filter[];\n    private responseSuccessFilters: Filter[];\n    private responseErrorFilters: Filter[];\n    private endpoint: Endpoint;\n    private method: HttpMethod;\n    private config: IAPIConfig;\n    constructor(options: AjaxOptions) {\n        this.url = options.url;\n        this.method = options.method;\n        if (options.filters) {\n            this.requestFilters = this.cloneFilters(options.filters.request);\n            this.responseErrorFilters = this.cloneFilters(\n                options.filters.failure\n            );\n            this.responseSuccessFilters = this.cloneFilters(\n                options.filters.success\n            );\n        }\n        this.endpoint = options.endpoint;\n        this.config = options.config;\n    }\n    public clone(): Ajax {\n        return new Ajax({\n            url: this.url,\n            method: this.method,\n            filters: {\n                request: this.cloneFilters(this.requestFilters),\n                failure: this.cloneFilters(this.responseErrorFilters),\n                success: this.cloneFilters(this.responseSuccessFilters),\n            },\n            endpoint: this.endpoint,\n            config: this.config,\n        });\n    }\n    public request(options?: IAjaxRequestOptions): AjaxRequest {\n        if (!options) {\n            options = {};\n        }\n\n        const responseSuccessFilters = this.resolveResponseSuccessFilters(\n            options.filters ? options.filters.success : undefined\n        );\n        const responseErrorFilters = this.resolveResponseErrorFilters(\n            options.filters ? options.filters.failure : undefined\n        );\n\n        const doRequestFilter = (\n            requestOptions: InternalAjaxRequestOptions,\n            chain: FilterChain\n        ) => {\n            const resolvedOptions = this.resolveRequestOptions(requestOptions);\n            return api\n                .request({\n                    ...resolvedOptions,\n                })\n                .then(response => {\n                    const result = new FilterChain(\n                        responseSuccessFilters,\n                        0\n                    ).start(response);\n                    if (result instanceof Promise) {\n                        return result.then(null, doErrorResponse);\n                    } else {\n                        return result;\n                    }\n                }, doErrorResponse);\n\n            function doErrorResponse(reason: any) {\n                const result = new FilterChain(responseErrorFilters, 0).start(\n                    reason\n                );\n                return Promise.reject(result);\n            }\n        };\n        const requestFilters = this.resolveRequestFilters(\n            options.filters ? options.filters.request : undefined,\n            doRequestFilter\n        );\n        return new FilterChain(requestFilters, 0).start({\n            ...options,\n            apiConfig: this.config,\n            url: this.url,\n        });\n    }\n    private resolveRequestOptions(\n        options: IAjaxRequestOptions\n    ): IRequestOptions {\n        const url: string = options.url;\n        const method = options.method || this.method;\n        const queries = options.queries;\n        let credential;\n        if(this.config.credential || options.credential) {\n            credential = Object.assign(\n                {},\n                this.config.credential,\n                options.credential\n            );\n        }\n        const headers = Object.assign({}, this.config.headers, options.headers);\n        return {\n            method,\n            url,\n            credential,\n            queries,\n            payload: options.formdata,\n            headers,\n            contentType: options.contentType,\n            responseType: options.responseType,\n        };\n    }\n    private resolveRequestFilters(\n        optionFilters: FiltersType,\n        doRequestFilter: Filter\n    ): Filter[] {\n        return this.concatFilters(\n            optionFilters,\n            this.requestFilters,\n            this.endpoint.requestFilters,\n            transformFilesParameterFilter,\n            doRequestFilter\n        );\n    }\n    private resolveResponseErrorFilters(optionFilters: FiltersType): Filter[] {\n        return this.concatFilters(\n            optionFilters,\n            this.responseErrorFilters,\n            this.endpoint.responseErrorFilters\n        );\n    }\n    private resolveResponseSuccessFilters(\n        optionFilters: FiltersType\n    ): Filter[] {\n        return this.concatFilters(\n            optionFilters,\n            this.responseSuccessFilters,\n            this.endpoint.responseSuccessFilters\n        );\n    }\n    private concatFilters(...filters: FiltersType[]): Filter[] {\n        return filters\n            .filter(filter => !!filter)\n            .reduce((all: FiltersType, item: FiltersType) => {\n                return (all as Filter[]).concat(item as Filter | Filter[]);\n            }, []) as Filter[];\n    }\n    private cloneFilters(filters?: Filter | Filter[]): Filter[] {\n        return Array.isArray(filters)\n            ? filters.slice(0)\n            : filters\n                ? [filters]\n                : [];\n    }\n}\n","import {\n    IAjaxRequestOptions,\n    IAPIConfig,\n    IParamConfig,\n    RequestParamField,\n} from '../types';\nimport FilterChain from '../FilterChain';\n\nconst requestOptionFields: RequestParamField[] = [\n    'pathVariables',\n    'queries',\n    'headers',\n    'formdata',\n];\n\nexport default function(\n    ajaxConfig: IAPIConfig\n): Array<(options: IAjaxRequestOptions, chain: FilterChain) => any> {\n    return requestOptionFields\n        .filter((name: RequestParamField) => !!ajaxConfig[name])\n        .map(field => createFilter(ajaxConfig[field] as IParamConfig[], field));\n\n    function createFilter(\n        paramConfigs: IParamConfig[],\n        field: RequestParamField\n    ): (options: IAjaxRequestOptions, chain: FilterChain) => any {\n        return (options: IAjaxRequestOptions, chain: FilterChain) => {\n            let pairs = options[field];\n            if (pairs === undefined) {\n                pairs = options[field] = {};\n            }\n            for (const paramConfig of paramConfigs) {\n                const paramName = paramConfig.name;\n                let value;\n                if (typeof FormData !== 'undefined' && pairs instanceof FormData) {\n                    value = pairs.get(paramName);\n                } else {\n                    value = (pairs as any)[paramName];\n                }\n                if (\n                    paramConfig.required !== false &&\n                    value === undefined &&\n                    paramConfig.defaultValue === undefined\n                ) {\n                    return chain.error(\n                        new Error(\n                            `Required parameter '${paramName}' of ${field} is missing and 'defaultValue' of api config is not defined.`\n                        )\n                    );\n                }\n            }\n            return chain.next(options);\n        };\n    }\n}\n","import {\n    IAjaxRequestOptions,\n    IAPIConfig,\n    IParamConfig,\n    RequestParamField,\n} from '../types';\nimport FilterChain from '../FilterChain';\n\nconst requestOptionFields: RequestParamField[] = [\n    'pathVariables',\n    'queries',\n    'headers',\n    'formdata',\n];\n\nexport default function(\n    ajaxConfig: IAPIConfig\n): Array<(options: IAjaxRequestOptions, chain: FilterChain) => any> {\n    return requestOptionFields\n        .filter((name: RequestParamField) => !!ajaxConfig[name])\n        .map(field => createFilter(ajaxConfig[field] as IParamConfig[], field));\n\n    function createFilter(\n        paramConfigs: IParamConfig[],\n        field: RequestParamField\n    ): (options: IAjaxRequestOptions, chain: FilterChain) => any {\n        return (options: IAjaxRequestOptions, chain: FilterChain) => {\n            let pairs = options[field];\n            if (!pairs) {\n                pairs = options[field] = {};\n            }\n            for (const paramConfig of paramConfigs) {\n                const paramName = paramConfig.name;\n                let value: any;\n                if (paramConfig.defaultValue === undefined) {\n                    return chain.next(options);\n                }\n\n                if (pairs instanceof FormData) {\n                    value = pairs.get(paramName);\n                } else {\n                    value = pairs[paramName];\n                }\n\n                if (value === undefined) {\n                    value = paramConfig.defaultValue;\n                }\n\n                if (pairs instanceof FormData) {\n                    pairs.set(name, value);\n                } else {\n                    pairs[name] = value;\n                }\n            }\n            return chain.next(options);\n        };\n    }\n}\n","import {\n    IAjaxRequestOptions,\n    IAPIConfig,\n    IParamConfig,\n    RequestParamField,\n} from '../types';\nimport FilterChain from '../FilterChain';\n\nconst requestOptionFields: RequestParamField[] = [\n    'pathVariables',\n    'queries',\n    'headers',\n    'formdata',\n];\n\nexport default function(\n    ajaxConfig: IAPIConfig\n): Array<(options: IAjaxRequestOptions, chain: FilterChain) => any> {\n    return requestOptionFields\n        .filter((name: RequestParamField) => !!ajaxConfig[name])\n        .map(field => createFilter(ajaxConfig[field] as IParamConfig[], field));\n\n    function createFilter(\n        paramConfigs: IParamConfig[],\n        field: RequestParamField\n    ): (options: IAjaxRequestOptions, chain: FilterChain) => any {\n        return (options: IAjaxRequestOptions, chain: FilterChain) => {\n            for (const paramConfig of paramConfigs) {\n                const validator = paramConfig.validator;\n                options = JSON.parse(JSON.stringify(options));\n                let pairs = options[field];\n                if (!pairs) {\n                    pairs = options[field] = {};\n                }\n                const paramName = paramConfig.name;\n                let value;\n                if (typeof FormData !=='undefined' && pairs instanceof FormData) {\n                    value = pairs.get(paramName);\n                } else {\n                    value = (pairs as any)[paramName];\n                }\n                if (\n                    validator !== undefined &&\n                    validator.call(paramConfig, value, options)\n                ) {\n                    throw new Error(\n                        `Parameter '${paramName}' validation failed: ${value}\\r\\nurl: ${\n                            ajaxConfig.url\n                        }`\n                    );\n                }\n            }\n            return chain.next(options);\n        };\n    }\n}\n","import { Primitive } from './types';\n\nexport type TemplateVariales =\n    | undefined\n    | {\n          [key: string]: Primitive;\n      };\n\nexport type notFoundCallback = (key:string) => string;\ntype Parser = (variables: TemplateVariales, notFound?:notFoundCallback) => string;\n\n// const PATH_VARIABLE_REGEX = /\\$\\{([^\\}]+)\\}/g;\n\nfunction mkreg(str: string): string {\n    return str.replace(/([\\$\\[\\]\\(\\)\\{\\}\\^\\+\\.\\*\\?\\\\\\-])/g, '\\\\$1');\n}\n/**\n *\n * @param {string} text - template string\n * @param {string} [prefix='${'] - 占位符 前缀\n * @param {string} [suffix='}'] - 占位符后缀\n * @param {boolean} [useReg=false] - 如果为true,则不会替换占位符的正则表达式的特殊符号， 默认为false\n */\nfunction parse(\n    text: string,\n    prefix: string = '${',\n    suffix: string = '}',\n    useReg: boolean = false\n): Template {\n    if (typeof text !== 'string') {\n        return merge.bind(null, []);\n    }\n    const prefReg = !useReg ? mkreg(prefix) : prefix;\n    const sufReg = !useReg ? mkreg(suffix) : suffix;\n    const reg = new RegExp(`${prefReg}(.*?)${sufReg}`, 'g');\n\n    const compiled: Parser[] = [];\n    let lastIndex = 0;\n    while (true) {\n        const result = reg.exec(text);\n        if (result === null) {\n            break;\n        }\n        const match = result[0];\n        const key = result[1];\n        const index = result.index;\n\n        compiled.push(textplain.bind(null, text.slice(lastIndex, index)));\n\n        compiled.push(placeholder.bind(null, key));\n\n        lastIndex = index + match.length;\n    }\n    compiled.push(textplain.bind(null, text.slice(lastIndex)));\n    return new Template(merge.bind(null, compiled));\n}\n\nfunction textplain(text: string, variables?: TemplateVariales) {\n    return text;\n}\n\nfunction placeholder(key: string, variables: TemplateVariales, notFound?: notFoundCallback) {\n    if (!variables) {\n        return '';\n    }\n    if(key in variables) {\n        return variables[key];\n    } else if(notFound !== undefined) {\n        return notFound(key);\n    }\n    return '';\n}\n\nfunction merge(compiled: Parser[], variables: TemplateVariales, notFound?:notFoundCallback) {\n    if (!variables) {\n        variables = {};\n    }\n    return compiled.map(parser => parser(variables, notFound)).join('');\n}\n\nexport default class Template {\n    public static readonly parse = parse;\n    constructor(private parsed: (variables: TemplateVariales, notFound?: notFoundCallback) => string) {}\n    public execute(variables: TemplateVariales, notFound?:notFoundCallback ): string {\n        return this.parsed(variables, notFound);\n    }\n}\n\nconst res = Template.parse(\n    'http://127.0.0.1:8989/api/:who/:where/',\n    ':',\n    '(?=(/|\\\\\\\\))',\n    true\n).execute({\n    who: 'maria',\n    where: 'USA'\n}, function notFound(key) {\n    return ':' + key;\n});\nconsole.info(res);\n","import { InternalAjaxRequestOptions } from '../types';\nimport FilterChain from '../FilterChain';\nimport Template from '../Template';\n\nconst templateCache: {\n    [url: string]: Template;\n} = {};\n\nexport default function pathVariableFilter(\n    options: InternalAjaxRequestOptions,\n    chain: FilterChain\n): any {\n    const variables = options.apiConfig.pathVariables;\n    const vars = options.pathVariables || {};\n    if (variables) {\n        variables.forEach(variable => {\n            const name = variable.name;\n            const defaultValue = variable.defaultValue;\n            if (vars[name] === undefined && defaultValue !== undefined) {\n                vars[name] = defaultValue;\n            }\n        });\n    }\n\n    const encodedVariables: {\n        [key: string]: string;\n    } = {};\n\n    for (const [key, value] of Object.entries(vars)) {\n        let decoded = value;\n        try {\n            decoded = decodeURI(decoded);\n        } catch (error) {\n            // ignored\n        }\n        encodedVariables[key] = encodeURI(decoded);\n    }\n    options.pathVariables = encodedVariables;\n\n    let template = templateCache[options.url];\n    if (!template) {\n        template = templateCache[options.url] = Template.parse(\n            options.url,\n            ':',\n            '(?=(/|\\\\\\\\|\\\\.))',\n            true\n        );\n    }\n    options.url = template.execute(encodedVariables, (key) => `:${key}`);\n\n    return chain.next(options);\n}\n","import { InternalAjaxRequestOptions } from '../types';\nimport FilterChain from '../FilterChain';\n\nexport default function(\n    options: InternalAjaxRequestOptions,\n    chain: FilterChain\n): any {\n    const queries = options.queries || {};\n    const queriesConfig = options.apiConfig.queries;\n    if (queriesConfig) {\n        queriesConfig.forEach(query => {\n            const name = query.name;\n            if (\n                query.defaultValue !== undefined &&\n                queries[name] === undefined\n            ) {\n                queries[name] = query.defaultValue;\n            }\n        });\n    }\n    options.queries = queries;\n    return chain.next(options);\n}\n","import { InternalAjaxRequestOptions } from '../types';\nimport FilterChain from '../FilterChain';\n\nexport default function jsonParameterFilter(\n    options: InternalAjaxRequestOptions,\n    chain: FilterChain\n): any {\n    if (options.json) {\n        if (typeof options.json === 'string') {\n            options.formdata = JSON.parse(options.json);\n        } else {\n            options.formdata = options.json;\n        }\n        options.contentType = 'application/json';\n    }\n    return chain.next(options);\n}\n","import { Filter } from './FilterChain';\nimport { join as joinPath } from './path';\nimport {\n    IAPIConfig,\n    FilterOpportunity,\n    IEndpointConfigure,\n    HttpMethod,\n} from './types';\nimport Ajax from './Ajax';\nimport validateRequiredParameterFilters from './internal/validateRequiredParameterFilters';\nimport defaultValueFilter from './internal/defaultValueFilter';\nimport optionsValidatorFilters from './internal/optionsValidatorFilters';\nimport pathVariableFilter from './internal/pathVariableFilter';\nimport queriesFilter from './internal/queriesFilter';\nimport jsonParameterFilter from './internal/jsonParameterFilter';\n\ntype ComplexFiltersType = Filter | Filter[] | undefined;\n\nconst OPPORTUNITY_RESPONSE_ERROR = 'response-error';\nconst OPPORTUNITY_REQUEST = 'request';\nconst OPPORTUNITY_RESPONSE_SUCCESS = 'response-success';\n\ninterface ICachedAPIConfig extends IAPIConfig {\n    original: IAPIConfig;\n}\n\nexport default class Endpoint {\n    public static OPPORTUNITY_REQUEST: string = OPPORTUNITY_REQUEST;\n    public static OPPORTUNITY_RESPONSE_ERROR: string = OPPORTUNITY_RESPONSE_ERROR;\n    public static OPPORTUNITY_RESPONSE_SUCCESS: string = OPPORTUNITY_RESPONSE_SUCCESS;\n\n    public requestFilters: Filter[] = [pathVariableFilter, queriesFilter];\n    public responseSuccessFilters: Filter[] = [];\n    public responseErrorFilters: Filter[] = [];\n    private apis: Map<string, ICachedAPIConfig> = new Map();\n\n    constructor(private server: string, private basePath: string = '') {}\n\n    public addFilter(filter: Filter, opportunity: FilterOpportunity): Endpoint {\n        switch (opportunity) {\n            case FilterOpportunity.REQUEST:\n                this.requestFilters = this.requestFilters.concat(filter);\n                break;\n            case FilterOpportunity.RESPONSE_ERROR:\n                this.responseErrorFilters = this.responseErrorFilters.concat(\n                    filter\n                );\n                break;\n            case FilterOpportunity.RESPONSE_SUCCESS:\n                this.responseSuccessFilters = this.responseSuccessFilters.concat(\n                    filter\n                );\n                break;\n            default:\n                throw new Error(`Unexpected opportunity value: ${opportunity}`);\n        }\n        return this;\n    }\n    public registerAPI(name: string, config: IAPIConfig): Endpoint {\n        if (this.apis.has(name)) {\n            throw new Error(`Duplicated api name: ${name}`);\n        }\n        const { path, method = 'GET' } = config;\n        let { url } = config;\n\n        if (!url && !path) {\n            throw new Error(\n                'API configuration error: missing \"url\" and \"path\"'\n            );\n        } else if (!url) {\n            url = joinPath(this.server, this.basePath, path || '');\n        }\n\n        const filters: {\n            request: Filter[];\n            success: Filter[];\n            failure: Filter[];\n        } = {\n            request: [],\n            success: [],\n            failure: [],\n        };\n\n        filters.request = filters.request\n            .concat(validateRequiredParameterFilters(config))\n            .concat(defaultValueFilter(config))\n            .concat(optionsValidatorFilters(config));\n\n        if (config.formdata) {\n            filters.request.unshift(jsonParameterFilter);\n        }\n        const apiFilters = config.filters;\n        if (apiFilters && apiFilters.request) {\n            if (typeof apiFilters.request === 'function') {\n                filters.request.unshift(apiFilters.request);\n            } else if (Array.isArray(apiFilters.request)) {\n                filters.request = apiFilters.request.concat(filters.request);\n            }\n        }\n\n        const cachedApiConfig = {\n            ...config,\n            url,\n            method,\n            original: config,\n            filters: {\n                ...filters,\n            },\n        } as ICachedAPIConfig;\n\n        this.apis.set(name, cachedApiConfig);\n\n        return this;\n    }\n    public configure({\n        basePath,\n        filters,\n        apis,\n    }: IEndpointConfigure): Endpoint {\n        if (basePath) {\n            this.basePath = basePath;\n        }\n        if (filters) {\n            this.addFilters(filters.request, FilterOpportunity.REQUEST);\n            this.addFilters(filters.failure, FilterOpportunity.RESPONSE_ERROR);\n            this.addFilters(\n                filters.success,\n                FilterOpportunity.RESPONSE_SUCCESS\n            );\n        }\n        if (apis) {\n            Object.keys(apis).forEach(name =>\n                this.registerAPI(name, apis[name])\n            );\n        }\n        return this;\n    }\n    public api(name: string): any {\n        if (!this.apis.has(name)) {\n            throw new Error(`api '${name}' has not been registered!`);\n        }\n\n        const config = this.apis.get(name);\n        if (!config) {\n            return;\n        }\n        return new Ajax({\n            url: config.url || '',\n            endpoint: this,\n            method: config.method || HttpMethod.GET,\n            config: config || ({} as ICachedAPIConfig),\n            filters: config.filters,\n            // url: config.url,\n            // endpoint: this,\n            // method: config.method\n            // origin\n        });\n    }\n    private addFilters(filters: ComplexFiltersType, opt: FilterOpportunity) {\n        if (filters && !(filters instanceof Array)) {\n            filters = [filters] as ComplexFiltersType;\n        }\n        (filters as Filter[]).filter(filter => !!filter).forEach(filter => {\n            this.addFilter(filter, FilterOpportunity.REQUEST);\n        });\n    }\n}\n","import Endpoint from './core/Endpoint';\nimport FilterChain from './core/FilterChain';\n\nexport default {\n    Endpoint,\n    FilterChain,\n};\n"],"names":["request.get","request.del","request.patch","request.head","request.post","request.put","filetype.call","requestOptionFields","joinPath","tslib_1.__assign"],"mappings":"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"}